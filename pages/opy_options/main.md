---
Copyright: (C) Ryuichi Ueda
---

# the opy book


* [目次に戻る](/?page=opy_book)

* [1. はじめに](/?page=opy_intro)
* [2. レコードとアクション](/?page=opy_action)
* [3. パターンによる検索](/?page=opy_pattern)
* [4. ルール（パターン + アクション）](/?page=opy_rule)
* [5. モジュールの利用](/?page=opy_module)

## 6. オプション

### 6.1 -s（string mode）

　`-s`を指定すると、レコードをフィールドに分割する際に数字への変換が行われません。これは、次のような処理に便利です。

```
$ echo 100 JPY | opy '[F1+F2]'
（エラー！！）
### -sをつけると100が文字列として解釈される ###
$ echo 100 JPY | opy -s '[F1+F2]'
100JPY
```

　また、`-s`をつけると数字への変換処理がなくなるので、処理が早く終わります。例を示します。

```
$ time seq 1 0.1 10000 | opy -s '[F1,"円"]' > /dev/null

real	0m1.604s
user	0m1.538s
sys	0m0.082s
$ time seq 1 0.1 10000 | opy '[F1,"円"]' > /dev/null

real	0m2.157s
user	0m2.066s
sys	0m0.098s
```

### 6.2 -v（シェル変数の取り込み）

　`-v`を利用すると、bashなどで定義されている変数をopy内に取り込むことができます。例を示します。

```
$ a=abc
$ opy -v "b=$a" 'B:[b*2]'
abcabc
```

`-v "b=$a"`で、シェルの変数`a`の文字列をPythonの`b`という変数として取り込めます。

　シェルの変数に整数、小数として解釈できる文字列が入っている場合、型変換が起こります。例を示します。


```
$ a=11
$ opy -v "b=$a" 'B:[b**2]'
121
$ a=3.14
$ opy -v "c=$a" 'B:[math.cos(c)]'
-0.9999987317275395
```

ただし、`-s`と併用すると、型変換は起こりません。次の例では、`123`は文字列として解釈されます。

```
$ a=123
$ opy -v "a=$a" -s 'B:[a*2]'
```

　二つ以上の変数を`-v`で取り込むことも可能です。この場合、変数を取り込む式の前に一つずつ`-v`を指定します。例を示します。


```
$ opy -v "a=$a" -v "b=$b" 'B:[a,b]'
abc 111
```

### 6.3 -i, -I, -o（区切り文字の指定）

　レコードを読み込むときの区切り文字は、`-i`オプションで変更できます。

```
$ echo 'a,b,c' | opy -i , '[F2]'
b
```

空文字を指定すると、文字ごとにフィールド分割されます。

```
$ echo abc | opy -i '' '[F2]'
b
```


　`-I`は区切り文字に正規表現を用いるときに使います。例を示します。正規表現`[,@]`で、「`,`あるいは`@`で区切る」という意味になります。

```
$ echo a,b@c | opy -I '[,@]' '[F1,F2,F3]'
a b c
```

　`-o`は、出力の区切り文字の指定に用います。上の例の出力を`=`で区切ってみたのが次の例です。

```
$ echo a,b@c | opy -I '[,@]' -o '=' '[F1,F2,F3]'
a=b=c
```

### 6.4 -c（CSVの読み込み）

　`-c`を使うとCSV（comma separated values）を読み込むことができます。
CSVには方言がありますが、opyの場合は内部でcsvモジュールの`reader`
メソッドを使うので、csvモジュールの解釈に従う様式のものが解釈できるということになります。


　次の例は`a`、`b,`、`c"`という3つの値を有するレコードを入力した例です。

```
$ echo 'a,"b,","c"""' | opy -c '[F1,F2,F3]'
a b, c"
```


　`-c`と`-s`は併用できます。次の例は`-s`があるときとないときの比較です。

```
$ echo 1,2,3 | opy -s -c '[F1+F2+F3]'
123
$ echo 1,2,3 | opy -c '[F1+F2+F3]'
6
```
